version: "3.3"

services:
    es01:
        image: docker.elastic.co/elasticsearch/elasticsearch:7.16.3
        container_name: es01
        environment:
            - discovery.type=single-node
            - bootstrap.memory_lock=true
            - http.port=9200
            - http.cors.enabled=true
            - http.cors.allow-origin=*
            - http.cors.allow-headers=*
            - http.cors.allow-credentials=true
            - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
        ulimits:
            memlock:
                soft: -1
                hard: -1
        ports:
            - 9200:9200
            - 9300:9300
        networks:
            - elastic
        volumes:
            - esdata:/usr/share/elasticsearch/data
            - esplugins:/usr/share/elasticsearch/plugins
    kib01:
        image: docker.elastic.co/kibana/kibana:7.16.3
        container_name: kib01
        ports:
            - 5601:5601
        networks:
            - elastic
        environment:
            ELASTICSEARCH_HOSTS: '["http://es01:9200"]'
            ELASTICSEARCH_URL: http://es01:9200

volumes:
    esdata:
        driver: local
    esplugins:
        driver: local

networks:
    elastic:
        driver: bridge
